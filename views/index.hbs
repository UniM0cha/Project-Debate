<html>
  <head>
    <meta charset='utf-8' />
    <title>실시간 토론 페이지</title>
    <script
      src='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js'
      integrity='sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p'
      crossorigin='anonymous'
    ></script>
    <script
      src='https://cdn.socket.io/4.4.0/socket.io.min.js'
      integrity='sha384-1fOn6VtTq3PWwfsOrk45LnYcGosJwzMHv+Xh/Jx5303FVOXzEnw0EpLv30mtjmlj'
      crossorigin='anonymous'
    ></script>
    <link
      href='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css'
      rel='stylesheet'
      integrity='sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3'
      crossorigin='anonymous'
    />
    <link rel='stylesheet' href='css/index.css' />
  </head>

  <body>

    <!-- 상단 메뉴 -->
    <nav class='navbar navbar-lg navbar-dark bg-dark'>
      <form class='form-ex-debatelist' action='/list'>
        <button type='submit' class='btn btn-light btn-ex-debatelist'>이전
          리스트</button>
      </form>

      <a class='title' href='#'>
        토론 사이트</a>

      {{! isLogined(:boolean) 라는 이름으로 로그인 되었는지 안되었는지 세션에 등록되어 있음 }}
      {{! isLogined 변수를 통해서 로그인/로그아웃 버튼을 표시하는 로직 구현해야함 }}
      {{! 지금은 임시로 로그아웃 버튼을 같이 나오게 생성함 }}

      <form class='form-login expand' action='/auth'>
        <button type='submit' class='btn btn-light btn-login'>로그인</button>
      </form>
      <form class='form-logout expand' action='/auth/logout'>
        <button type='submit' class='btn btn-light btn-logout'>로그아웃</button>
      </form>

      <script>
        const loginform = document.querySelector('.form-login'); 
        const logoutform = document.querySelector('.form-logout');

        //로그인했을때->로그아웃버튼, 로그인안했을때->로그인 버튼
        if({{isLogined}}== true)
        { loginform.style.display = 'none';
          logoutform.style.display ='block';}
        else
        { loginform.style.display = 'block';
          logoutform.style.display ='none'}
      </script>
    </nav>

    <!-- 주제 -->
    <div class='time-topic-div'>
      <div class='time'>
        주제의 남은 시간 표시
      </div>
      <div class='topic'>
        주제
      </div>
    </div>

    <!-- 찬성반대투표바 -->
    <div class='age-dis-bar-wrapper'>
      <div class='agree-bar'>찬성: {{agree-persent}}</div>
      <div class='disagree-bar'>반대: {{disagree-persent}}</div>

      <button class='bar-button agree-btn'>찬성</button>
      <button class='bar-button disagree-btn'>반대</button>
    </div>

    <script>
      //로그인에 따른 찬성반대 버튼 및 찬반 비율
      const agree_bar = document.querySelector('.agree-bar');
      const disagree_bar = document.querySelector('.disagree-bar');
      const agree_btn = document.querySelector('.agree-btn');
      const disagree_btn = document.querySelector('.disagree-btn');

      let agree = 50;
      let disagree = 50;

      if({{isLogined}} == true){
        agree_bar.style.display = 'none';
        disagree_bar.style.display = 'none';

        agree_btn.addEventListener('click', () => {
        agree = agree + 1;
        disagree = disagree - 1;
        console.log(agree);
        console.log(disagree);
        //찬성 반대 선택 이후 버튼 숨기기
        agree_btn.style.display = 'none';
        disagree_btn.style.display = 'none';
        //찬성 반대 비율 변경
        agree_bar.style.width = agree + '%';
        disagree_bar.style.width = disagree + '%';
        //찬성 반대 비율 바 보여주기
        agree_bar.style.display = 'block';
        disagree_bar.style.display = 'block';
      });

      disagree_btn.addEventListener('click', () => {
      agree = agree - 1;
      disagree = disagree + 1;
      console.log(agree);
      console.log(disagree);
      //찬성 반대 선택 이후 버튼 숨기기
      agree_btn.style.display = 'none';
      disagree_btn.style.display = 'none';
      //찬성 반대 비율 변경
      agree_bar.style.width = agree + '%';
      disagree_bar.style.width = disagree + '%';
      //찬성 반대 비율 바 보여주기
      agree_bar.style.display = 'block';
      disagree_bar.style.display = 'block';
      });

      }else{
        agree_btn.style.display = 'none';
        disagree_btn.style.display = 'none';
      }
    </script>

    <!-- 실시간 토론 하는 곳 -->
    <div class='debate-wrapper'>
      <div class='debate-box'>
        <ul class='live-debate' id='messages'>

          <li class='agree'>
            <div class='nickname'>usernickname</div>
            <div
              class='user-opinion'
            >찬성의견안녕하세요요요용요요요요요요용요요요요</div>
            <div class='opinion-time'>오후 01:36</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>

          <li class='disagree'>
            <div class='nickname'>usernickname</div>
            <div class='opinion-time'>오후 01:37</div>
            <div class='user-opinion'>반대의견</div>
          </li>
        </ul>
      </div>

      <div class='input-box'>
        <input class='opinion-input' type='text' />
        <button class='send' type='button'>전송</button>
      </div>

{{!-- 로그인 시 채팅 가능/아닐 시 채팅 못 침 --}}
      <script>
        const input_box = document.querySelector('.opinion-input');
        const send_btn = document.querySelector('.send');
        const live_debate = document.querySelector('.live-debate');
        //스크롤 아래 고정
        live_debate.scrollTop = live_debate.scrollHeight

        //로그인에 따른 채팅 가능 불가능 설정
        if({{isLogined}} == true){
          input_box.style.display = 'block';
          send_btn.style.display = 'block';
        }else{
          input_box.style.display = 'none';
          send_btn.style.display = 'none';
          live_debate.style.height = "100%";
        }
      </script>
    </div>
  </body>
  <script src="js/index.js"></script>
</html>